services:
  hytale:
    build: .
    container_name: hytale-server

    # Interactive mode for authentication
    stdin_open: true
    tty: true

    # UDP port for QUIC
    ports:
      - "5520:5520/udp"

    # Environment variables
    environment:
      - JAVA_HEAP_SIZE=4G
      - SERVER_PORT=5520
      - USE_AOT_CACHE=true
      # Version management
      - AUTO_UPDATE=true
      - PATCHLINE=release
      # Additional arguments
      - EXTRA_JAVA_ARGS=
      - EXTRA_SERVER_ARGS=

    # Volumes for persistence
    volumes:
      # Named volume for server data
      - hytale-data:/server
      # Credentials file mounted from host (rw needed for token refresh)
      - ./.hytale-downloader-credentials.json:/server/.hytale-downloader-credentials.json

    # Restart policy
    restart: unless-stopped

    # Resource limits
    deploy:
      resources:
        limits:
          memory: 6G
        reservations:
          memory: 4G

volumes:
  hytale-data:
    name: hytale-data
